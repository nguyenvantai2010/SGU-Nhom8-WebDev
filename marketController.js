export const market = {
  "Toán và lập trình": {
    hidden: false,
    items: [
      {
        id: 1,
        name: "Toán",
        price: "45",
        image: "https://toanmath.com/wp-content/uploads/2024/02/sach-giao-khoa-toan-12-tap-1-ket-noi-tri-thuc-voi-cuoc-song.png",
        active: true,
        description: "Giáo trình Toán lớp 12 giúp học sinh nắm vững kiến thức nền tảng.",
        quantity: 18,
        releaseYear: 2024,
        cost_price: 36
      },
      {
        id: 2,
        name: "Giải tích 1",
        price: "85",
        image: "../assets/images/vantai.png",
        active: true,
        description: "Khám phá các khái niệm giới hạn, đạo hàm và tích phân.",
        quantity: 10,
        releaseYear: 2023,
        cost_price: 68
      },
      {
        id: 3,
        name: "Xác suất thống kê",
        price: "30",
        image: "../assets/images/nguyenvantaingu.png",
        active: true,
        description: "Tài liệu cơ bản về xác suất và thống kê ứng dụng.",
        quantity: 22,
        releaseYear: 2022,
        cost_price: 24
      },
      {
        id: 4,
        name: "Lý thuyết đồ thị",
        price: "45",
        image: "../assets/images/ltđt.png",
        active: true,
        description: "Giới thiệu các khái niệm và thuật toán trong đồ thị.",
        quantity: 15,
        releaseYear: 2021,
        cost_price: 36
      },
      {
        id: 5,
        name: "Toán rời rạc",
        price: "45",
        image: "../assets/images/toanroirac.png",
        active: true,
        description: "Phân tích các cấu trúc toán học không liên tục.",
        quantity: 12,
        releaseYear: 2022,
        cost_price: 36
      },
      {
        id: 6,
        name: "Cơ sở dữ liệu",
        price: "90",
        image: "../assets/images/csdl.png",
        active: true,
        description: "Hướng dẫn thiết kế và quản lý hệ thống cơ sở dữ liệu.",
        quantity: 7,
        releaseYear: 2022,
        cost_price: 72
      },
      {
        id: 7,
        name: "Cấu trúc dữ liệu và giải thuật",
        price: "40",
        image: "../assets/images/cautrucduulieuvagiaithuat.png",
        active: true,
        description: "Tài liệu chuyên sâu về cấu trúc dữ liệu và thuật toán.",
        quantity: 16,
        releaseYear: 2023,
        cost_price: 32
      },
      {
        id: 8,
        name: "Kỹ thuật lập trình C",
        price: "15",
        image: "../assets/images/ktltC.png",
        active: true,
        description: "Giáo trình nhập môn lập trình với các ví dụ thực tế.",
        quantity: 25,
        releaseYear: 2025,
        cost_price: 12
      },
      {
        id: 9,
        name: "Lập trình Java cơ bản",
        price: "45",
        image: "../assets/images/ltjavacanban.png",
        active: true,
        description: "Học lập trình Java từ cơ bản.",
        quantity: 14,
        releaseYear: 2021,
        cost_price: 36
      },
      {
        id: 10,
        name: "Lập trình hướng đối tượng java",
        price: "85",
        image: "../assets/images/lthdtjava.png",
        active: true,
        description: "Giáo trình OOP với ví dụ minh họa bằng Java và C++.",
        quantity: 11,
        releaseYear: 2023,
        cost_price: 68
      },
      {
        id: 11,
        name: "Bài tập JavaScript",
        price: "30",
        image: "../assets/images/baitapjavascript.png",
        active: true,
        description: "Tài liệu học JavaScript cho phát triển web hiện đại.",
        quantity: 19,
        releaseYear: 2024,
        cost_price: 24
      },
      {
        id: 12,
        name: "C++",
        price: "45",
        image: "../assets/images/cpp.png",
        active: true,
        description: "Giáo trình C++ với các bài tập thực hành nâng cao.",
        quantity: 13,
        releaseYear: 2022,
        cost_price: 36
      },
      {
        id: 13,
        name: "Python",
        price: "85",
        image: "../assets/images/python.png",
        active: true,
        description: "Giáo trình Python dành cho phân tích dữ liệu và AI.",
        quantity: 9,
        releaseYear: 2024,
        cost_price: 68
      },
      {
        id: 14,
        name: "C#",
        price: "30",
        image: "../assets/images/cs.png",
        active: true,
        description: "Hướng dẫn lập trình C# với ứng dụng thực tế.",
        quantity: 17,
        releaseYear: 2021,
        cost_price: 24
      },
      {
        id: 15,
        name: "Kiến trúc máy tính",
        price: "30",
        image: "../assets/images/ktmt.png",
        active: true,
        description: "Nguyên cứu về bên trong máy tính",
        quantity: 17,
        releaseYear: 2021,
        cost_price: 24
      },
      {
        id: 16,
        name: "Mạng máy tính",
        price: "30",
        image: "../assets/images/mmmt.png",
        active: true,
        description: "Nguyên cứu về hệ thống mạng máy tính",
        quantity: 17,
        releaseYear: 2021,
        cost_price: 24
      },
      {
        id: 17,
        name: "Phát triển ứng dụng",
        price: "30",
        image: "../assets/images/ppungdung.png",
        active: true,
        description: "Nguyên cứu về cách tạo ứng dụng",
        quantity: 17,
        releaseYear: 2021,
        cost_price: 24
      },
      {
        id: 18,
        name: "Hợp ngữ",
        price: "30",
        image: "../assets/images/hopngu.png",
        active: true,
        description: "Tổng quan về hợp ngữ",
        quantity: 17,
        releaseYear: 2021,
        cost_price: 24
      },


    ]
  },

  "Triết và chính trị": {
    hidden: false,
    items: [
      {
        id: 19,
        name: "Triết học",
        price: "85",
        image: "../assets/images/triet.png",
        active: true,
        description: "Tổng quan các trường phái triết học phương Tây và phương Đông.",
        quantity: 8,
        releaseYear: 2020,
        cost_price: 68
      },
      {
        id: 20,
        name: "Pháp luật đại cương",
        price: "30",
        image: "../assets/images/pldc.png",
        active: true,
        description: "Cẩm nang pháp luật cơ bản dành cho sinh viên.",
        quantity: 20,
        releaseYear: 2023,
        cost_price: 24
      },
      {
        id: 21,
        name: "Cờ tướng",
        price: "30",
        image: "../assets/images/vodichthu.png",
        active: true,
        description: "Chiến thuật và kỹ năng chơi cờ tướng chuyên sâu.",
        quantity: 30,
        releaseYear: 2021,
        cost_price: 24
      },
      {
        id: 22,
        name: "Kinh tế chính trị",
        price: "45",
        image: "../assets/images/ktct.png",
        active: true,
        description: "Phân tích các học thuyết kinh tế và chính trị hiện đại.",
        quantity: 14,
        releaseYear: 2024,
        cost_price: 36
      },
      {
        id: 23,
        name: "Chủ nghĩa xã hội và khoa học",
        price: "45",
        image: "../assets/images/cnxhvakh.png",
        active: true,
        description: "Phân tích các học thuyết về chủ nghĩa xã hội",
        quantity: 14,
        releaseYear: 2024,
        cost_price: 36
      },
      {
        id: 24,
        name: "Lịch sử đảng",
        price: "85",
        image: "../assets/images/lichsudang.png",
        active: true,
        description: "Lịch sử đảng cộng sản việt nam",
        quantity: 8,
        releaseYear: 2020,
        cost_price: 68
      },
      {
        id: 25,
        name: "Nguyên lý chủ nghĩa mac-lênin",
        price: "85",
        image: "../assets/images/nguyenlycnmln.png",
        active: true,
        description: "Nguyên lý chủ nghĩa mac-lênin",
        quantity: 8,
        releaseYear: 2020,
        cost_price: 68
      },
      {
        id: 26,
        name: "Đường lối cách mạng Việt Nam",
        price: "85",
        image: "../assets/images/duongloicachmang.png",
        active: true,
        description: "Phân tích về đường lối cách mạng Việt Nam",
        quantity: 8,
        releaseYear: 2020,
        cost_price: 68
      },


    ]
  },

  "Ngôn ngữ học": {
    hidden: false,
    items: [
      {
        id: 27,
        name: "Tiếng anh A1",
        price: "85",
        image: "../assets/images/taa1.png",
        active: true,
        description: "Dành cho học phần tiếng anh A1",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 28,
        name: "Tiếng anh A2",
        price: "85",
        image: "../assets/images/taa2.png",
        active: true,
        description: "Dành cho học phần tiếng anh A2",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 29,
        name: "Tiếng anh B1",
        price: "85",
        image: "../assets/images/tab1.png",
        active: true,
        description: "Dành cho học phần tiếng anh B1",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 30,
        name: "Tiếng anh B2",
        price: "85",
        image: "../assets/images/tab2.png",
        active: true,
        description: "Dành cho học phần tiếng anh B2",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 31,
        name: "Tiếng anh C1",
        price: "85",
        image: "../assets/images/tac1.png",
        active: true,
        description: "Dành cho học phần tiếng anh C1",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 32,
        name: "Học tiếng trung",
        price: "85",
        image: "../assets/images/learnchinese.png",
        active: true,
        description: "Học tiếng trung, bingchiling",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 33,
        name: "Học tiếng nhật",
        price: "85",
        image: "../assets/images/learnjapan.png",
        active: true,
        description: "Oni-chan baka",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 34,
        name: "Học tiếng hàn",
        price: "85",
        image: "../assets/images/learnkorean.png",
        active: true,
        description: "Học tiếng hàn",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 35,
        name: "Học tiếng việt",
        price: "85",
        image: "../assets/images/learnvn.png",
        active: true,
        description: "Học tiếng việt",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 36,
        name: "Học tiếng pháp",
        price: "85",
        image: "../assets/images/learnfrench.png",
        active: true,
        description: "Học tiếng pháp",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 37,
        name: "Học tiếng đức",
        price: "85",
        image: "../assets/images/learngerman.png",
        active: true,
        description: "Học tiếng đức",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
    ]
  },

  "Kế toán, doanh nghiệp": {
    hidden: false,
    items: [
      {
        id: 38,
        name: "Nguyên lý kế toán",
        price: "85",
        image: "../assets/images/nlketoan.png",
        active: true,
        description: "Nguyên cứu kế toán",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 39,
        name: "Kế toán, tài chính doanh nghiệp",
        price: "85",
        image: "../assets/images/tcdn.png",
        active: true,
        description: "Nguyên cứu kế toán, tài chính doanh nghiệp",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 40,
        name: "Chính sách thuế",
        price: "85",
        image: "../assets/images/thue.png",
        active: true,
        description: "Nguyên cứu về thuế doanh nghiệp",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 41,
        name: "Nghiệp vụ ngân hàng",
        price: "85",
        image: "../assets/images/nvnganhang.png",
        active: true,
        description: "Nguyên cứu về nghiệp vụ ngân hàng",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 42,
        name: "Phân tích chứng khoáng",
        price: "85",
        image: "../assets/images/phantichck.png",
        active: true,
        description: "Phân tích về chứng khoáng",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 43,
        name: "Tài chính tiền tệ",
        price: "85",
        image: "../assets/images/tctt.png",
        active: true,
        description: "Phân tích về tài chính và tiền tệ",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 44,
        name: "Kế toán hành chính sự nghiệp",
        price: "85",
        image: "../assets/images/ketoanhcsp.png",
        active: true,
        description: "Phân tích về kế toán hành chính sự nghiệp",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 45,
        name: "Tài chính doanh nghiệp",
        price: "85",
        image: "../assets/images/taichinhdoanhnghiep.png",
        active: true,
        description: "Phân tích về tài chính của doanh nghiệp",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 46,
        name: "Tài chính quốc tế",
        price: "85",
        image: "../assets/images/taichinhquocte.png",
        active: true,
        description: "Phân tích về tài chính quốc tế",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 47,
        name: "Kinh tế phát triển",
        price: "85",
        image: "../assets/images/kinhtephattrien.png",
        active: true,
        description: "Phân tích về sự phát triển kinh tế",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 48,
        name: "Kiểm toán",
        price: "85",
        image: "../assets/images/kiemtoan.png",
        active: true,
        description: "Phân tích về kiểm toán",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 49,
        name: "Kinh tế học vĩ mô",
        price: "85",
        image: "../assets/images/kthvimo.png",
        active: true,
        description: "Phân tích về kinh tế học",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },
      {
        id: 50,
        name: "Tài chính học",
        price: "85",
        image: "../assets/images/taichinhhoc.png",
        active: true,
        description: "Phân tích về tài chính",
        quantity: 8,
        releaseYear: 2012,
        cost_price: 68
      },


    ]
  }
};
let minPrice = null;
let maxPrice = null;
let releaseYear = null;
let searchQuery = "";
let itemsPerPage = 10;
let selectedCategory = null;
let currentPage = 1;

const dataString = localStorage.getItem("adminProducts");
const marketItems = dataString?JSON.parse(dataString):market;
// Hiện thị item trong item-container
function renderMarketItems(page = 1) {
	const container = document.querySelector(".item-container");
	if (!container) return;
	container.innerHTML = "";

	const allItems = Object.values(marketItems).map(cat => cat.items).flat(); // Lấy mảng items bên trong rồi gộp lại

	const filteredItems = selectedCategory? (marketItems[selectedCategory]?.items || []): allItems; 

	const nameFiltered = filteredItems.filter(item => {
		const priceValue = parseFloat(item.price);
		const matchesName = item.name.toLowerCase().includes(searchQuery.toLowerCase());
		const matchesMin = minPrice === null || priceValue >= minPrice;
		const matchesMax = maxPrice === null || priceValue <= maxPrice;
		const matchesYear = releaseYear === null || item.releaseYear === releaseYear;

		return item.active && matchesName && matchesMin && matchesMax && matchesYear;
	});


	const start = (page - 1) * itemsPerPage;
	const end = start + itemsPerPage;
	const pageItems = nameFiltered.slice(start, end); // Mỗi trang có 1-10 item

	// Tạo item mới rồi bỏ vào item-container
	pageItems.forEach(item => {
		const itemDiv = document.createElement("div");
		itemDiv.classList.add("market-item");

		itemDiv.innerHTML = `
		<img src="${item.image}" alt="${item.name}" class="item-image" />
		<div class="item-info">
			<h3 class="item-name">${item.name}</h3>
			<p class="item-price">${item.price + "đ"}</p>
			<p class="item-quantity">Số lượng: ${item.quantity ?? 0}</p>
			<p class="item-release">Năm phát hành: ${item.releaseYear ?? "Không rõ"}</p>
		</div>
		`;

		container.appendChild(itemDiv);
  	});

  // rander thanh trang
  renderPagination(nameFiltered.length, page, itemsPerPage);
}

// Hiện thị thanh trang
function renderPagination(totalItems, currentPage, itemsPerPage) {
	const totalPages = Math.ceil(totalItems / itemsPerPage); // Tổng số trang trong category đã chọn
	const paginationContainer = document.querySelector(".pagination");
	paginationContainer.innerHTML = "";

	// Tạo nút chuyển trang
	const createButton = (label, page, disabled = false) => {
		const btn = document.createElement("button");
		btn.textContent = label;
		btn.disabled = disabled;
		btn.classList.add("page-btn");
		if (page === currentPage) btn.classList.add("active");
		btn.addEventListener("click", () => {
		renderMarketItems(page);
		});
		return btn;
 	};

	// Tạo nút quay lại
	paginationContainer.appendChild(createButton("Previous", currentPage - 1, currentPage === 1));

	// Insert các nút còn lại vào thanh trang
	for (let i = 1; i <= totalPages; i++) {
		paginationContainer.appendChild(createButton(i, i));
	}

	// Tạo nút chuyển trang tiếp theo 
	paginationContainer.appendChild(createButton("Next", currentPage + 1, currentPage === totalPages));
}

// Hiện thị thanh danh mục(category)
function renderCategoryBar() {
	const categoryBar = document.getElementById("categoryBar");
	if (!categoryBar) return;

	categoryBar.innerHTML = "";

	// Add "All" option => Hiện thị tất cả item
	const allBtn = document.createElement("div");
	allBtn.textContent = "All";
	allBtn.classList.add("category-btn");
	allBtn.addEventListener("click", () => {
		selectedCategory = null;
		renderMarketItems(1);
	});
	categoryBar.appendChild(allBtn);

	// Add Danh mục(categories) từ marketItems 
	Object.keys(marketItems).forEach(category => {
		const li = document.createElement("div");
		li.textContent = category;
		li.classList.add("category-btn");
		li.addEventListener("click", () => {
		selectedCategory = category;
		renderMarketItems(1);
		});
		categoryBar.appendChild(li);
	});
}

// Đối với admin thì sử dụng hàm này để thêm item vào marketItems
function addItemToCategory(item, category) {
	if (!marketItems[category]) {
		marketItems[category] = { hidden: false, items: [] };
	}
	marketItems[category].items.push({
		...item,
		description: item.description || "",
		quantity: item.quantity ?? 0
	});
}

// Đối với admin thì sử dụng hàm này để xóa item khỏi marketItems
function removeItemFromCategory(itemName, category) {
	if (!marketItems[category]) return;
	marketItems[category] = marketItems[category].filter(item => item.name !== itemName);
}

// Tìm kiếm theo giá
const minPriceInput = document.getElementById("minPriceBar");
const maxPriceInput = document.getElementById("maxPriceBar");
if (minPriceInput && maxPriceInput) {
	minPriceInput.addEventListener("input", e => {
		const value = parseFloat(e.target.value);
		minPrice = isNaN(value) ? null : value;
		renderMarketItems(1);
	});

	maxPriceInput.addEventListener("input", e => {
		const value = parseFloat(e.target.value);
		maxPrice = isNaN(value) ? null : value;
		renderMarketItems(1);
	});
}

// Tìm kiếm theo năm xuất bản
const releaseYearInput = document.getElementById("releaseYearBar");
if (releaseYearInput) {
  releaseYearInput.addEventListener("input", e => {
    const value = parseInt(e.target.value);
    releaseYear = isNaN(value) ? null : value;
    renderMarketItems(1);
  });
}

// Tìm kiếm theo tên
const searchInput = document.getElementById("searchInput");
if (searchInput) { // <-- THÊM DÒNG NÀY
	searchInput.addEventListener("input", e => {
	searchQuery = e.target.value.trim();
	renderMarketItems(1);
	});
} 

// Thay đổi các hiện thị khi window bị thay đổi khích thước
window.addEventListener("resize", () => {
   	renderMarketItems(1); // Re-render on resize
});

// Load lại trang
document.addEventListener("DOMContentLoaded", () => {
	renderCategoryBar();
	renderMarketItems(1);
});

// Click danh mục
document.querySelectorAll(".category-bar li").forEach(li => {
	li.addEventListener("click", () => {
		selectedCategory = li.textContent.trim();
		renderMarketItems(1);
	});
});
